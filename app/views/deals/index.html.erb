<%= provide(:title, "Deals") %>

<% if params[:search] && params[:search].present? %>
  <h2>Here's what BULK! could carry away from the site!</h2>
  <p>
    Please complete the missing fields. Deals with more info get more bids!
  </p>
  <p>
    So said The Bulk!
  </p>
  <%= render 'scrape_form' %>
<% else %>
  <p>
    Let us attempt to automagically create your deal!
  </p>
  <%= form_tag root_path, id: "search-form", method: :get do %>
    <p>
      <%= label_tag(:search, "Enter the URL:") %>
      <%= text_field_tag :search, params[:search] %>
      <%= submit_tag "Search", name: nil %>
    </p>
  <% end %>
<% end %>

<p>OR, you can: <%= link_to "Create A Deal!", new_deal_path %></p>
<h3>Latest Deals</h3>
<div class="wrapper">
  <% @deals.each do |deal| %>
  <div class="deal-box">
    <figcaption>
      <%= link_to image_tag(deal.image), deal %>
      <h2><%= link_to(truncate(deal.title, length: 30, seperator: ' '), deal)  %></h2>
      <div class="deal-detail">
        Expiration: <%= l deal.deal_expiration, format: :long %><br><br>
        <span class="retail">$<%= deal.retail_price %></span>
        |   $<span class="wholesale"><%= deal.wholesale_price %></span><br><br>
        <div class="progress-meter">
        	<span class="progress" style="width: <%= number_to_percentage(progress( deal.total_bids, deal.minimum_bids), precision: 0) %>;"></span>
        </div>
        Progress: <%= number_to_percentage(progress( deal.total_bids, deal.minimum_bids), precision: 0) %>
      </div>
    </figcaption>
  </div>
  <% end %>
</div>
