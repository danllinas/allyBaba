<div id="fb-root">
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.4&appId=1666401163591465";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>
</div>

<div class="deal-wrapper">
  <div class="deal-image">
    <%= image_tag @deal.image, class: "show-image" %>
  </div>
  <div class="conditional-text">
    <% if logged_in? %>
      <% if current_user.id == @deal.organizer.id %>
        <%= link_to 'Edit', edit_deal_path %> /
        <%= link_to 'Delete', @deal, method: :delete, data: { confirm: 'Are you sure you want to delete this deal?'} %>
      <% elsif current_user.orders.find_by(deal_id: @deal.id) %>
        <h2>You already joined this deal!</h2>
      <% else %>

          <button class="join-button deal"><%= link_to "Join this deal!", new_deal_order_path(@deal.id) %></button>

      <% end %>
    <% else %>
      <p>
        Go <span id="trigger">login</span> to jump on this deal!
      </p>
    <% end %>
  </div>
  <div class="deal-text">
    <h2 class="deal-title"><%= @deal.title %></h2>
    <span class="retail">$<%= @deal.retail_price %></span>
    |   <span class="wholesale">$<%= @deal.wholesale_price %></span><br><br>
    <div class="progress-meter">
      <span class="progress" style="width: <%= number_to_percentage(progress( @deal.total_bids, @deal.minimum_bids), precision: 0) %>;"></span>
    </div>
    Progress: <%= number_to_percentage(progress( @deal.total_bids, @deal.minimum_bids), precision: 0) %><br>
    Time Remaining: <%= ((@deal.deal_expiration - @deal.created_at) / 86400).to_i.to_s %> days<br><br>
  </div>
  <div class="description-text">
    Organizer: <%= @deal.organizer.first_name.capitalize %><br>
    Expiration: <%= l @deal.deal_expiration, format: :long %><br>
    Delivery: <%= l @deal.estimated_delivery, format: :long %><br>
    Original Deal: <%= @deal.url %><br><br><br>
    Description: <%= @deal.description %><br><br>
  </div>
</div>

<div class="fb-share-button fb-position" data-href="https://developers.facebook.com/docs/plugins/" data-layout="button_count">
</div>
